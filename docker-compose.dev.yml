version: '3.9'

volumes:
  web_node_modules:
  web_nuxt_built:

services:
  api:
    image: szainmehdi/php:8.1-dev-20211203
    working_dir: /var/www/api
    environment:
      - APP_ENV=local
      - XDEBUG_MODE=debug
      - XDEBUG_CLIENT_PORT=9003
      - XDEBUG_IDE_KEY=PHPSTORM
      - XDEBUG_CLIENT_HOST=host.docker.internal
    volumes:
      - ./api:/var/www/api:delegated
  queue:
    image: szainmehdi/php:8.1-dev-20211203
    working_dir: /var/www/api
    environment:
      - APP_ENV=local
    volumes:
      - ./api:/var/www/api:delegated
  web:
    command: ['yarn', 'watcher']
    working_dir: /opt
    build:
      context: ./nuxt
      target: dev
    volumes:
      - ./nuxt:/opt:delegated
      - web_node_modules:/opt/node_modules
      - web_nuxt_built:/opt/.nuxt
    environment:
      - BUILD_AXIOS_DEBUG=
      - CHOKIDAR_USEPOLLING=true
      - SERVER_API_BASE_URL=http://api.nawhas.test
  mail:
    image: mailhog/mailhog:latest
    restart: unless-stopped
    ports:
      - "8025:8025"
    networks:
      nawhas:
        aliases:
          - mail
