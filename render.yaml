services:
  # Staging: Vue Frontend App
  - type: web
    name: staging-nawhas
    env: static
    buildCommand: cd web && yarn install --frozen-lockfile && yarn build
    staticPublishPath: ./web/dist
    pullRequestPreviewsEnabled: false
    domains:
      - staging.nawhas.com
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
    envVars:
      - key: VUE_APP_API_DOMAIN
        value: https://api.staging.nawhas.com
  # Staging API PHP Service
  - type: web
    name: api-staging-nawhas
    plan: standard
    env: docker
    autoDeploy: true
    dockerfilePath: ./api/Dockerfile
    dockerContext: ./api
    envVars:
      - key: DB_HOST
        fromDatabase:
          name: postgres-staging-nawhas
          property: host
      - key: DB_USERNAME
        fromDatabase:
          name: postgres-staging-nawhas
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: postgres-staging-nawhas
          property: password

databases:
  - name: postgres-staging-nawhas
    databaseName: nawhas
